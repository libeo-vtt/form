!function(r){var e=function(e,s){this.form=r(e),this.config=r.extend({modifiers:{"!":"not"},customGlobalClasses:{}},s||{}),this.classes=r.extend({active:"is-active",open:"is-open",hover:"is-hover",clicked:"is-clicked",extern:"is-external",error:"is-error"},this.config.customGlobalClasses||{}),this.errors=[],this.init()};r.extend(e.prototype,{init:function(){this.bindEvents()},bindEvents:function(){this.form.on("submit",r.proxy(function(r){this.resetErrors(),this.validate(),this.displayErrors(),this.errors.length>0&&r.preventDefault()},this))},bindErrorsEvents:function(){this.form.find(".errors a").on("click",r.proxy(function(e){var s=this.form.find(e.currentTarget.hash).parents(".field").find("label"),t=this.form.find(e.currentTarget.hash);t.focus(),r(window).scrollTop(s.offset().top),e.preventDefault()},this))},validate:function(){var e=this.form.find("input, textarea, select, fieldset");this.errors=[],e.each(r.proxy(function(r,e){"fieldset"===e.tagName.toLowerCase()?this.validateFieldset(e):this.validateInput(e)},this))},validateInput:function(e){var s=r(e).val(),t=this.isNumber(s)?parseInt(s):s,i=this.getValidationTerms(e),n=!1;i&&_.each(i,r.proxy(function(s){var i=!0,o=this.getTerm(s),a=this.getModifier(s),h=this.getCompare(e,o);if(!this.isNumber(t)&&this.isNumber(h)&&(t=t.length),"field"===o)$comparingField=r(h),$input=r(e),$input.val()!=$comparingField.val()&&(i=!1);else if("regex"===o){var f=new RegExp(h);i=f.test(t)}else i=a!==!1?is[a][o](t,h)?i:!1:is[o](t,h)?i:!1;i||"empty"!==o||(n=!0,this.newError(e,this.getErrorMessage(e,o))),i||n||this.newError(e,this.getErrorMessage(e,o))},this))},validateFieldset:function(e){var s=r(e).find("input"),t=this.getValidationTerms(e),i=(r(e).find("legend"),[]),n=!1;s.each(function(e,s){r(s).is(":checked")&&i.push(s)}),t&&_.each(t,r.proxy(function(r){var s=!0,t=this.getTerm(r),o=this.getModifier(r),a=this.getCompare(e,t);"empty"===t?(s=o!==!1?is[o][t](i,a)?s:!1:is[t](i,a)?s:!1,s||(n=!0,this.newFieldsetError(e,this.getErrorMessage(e,t)))):(s=o!==!1?is[o][t](i.length,a)?s:!1:is[t](i.length,a)?s:!1,s||n||this.newFieldsetError(e,this.getErrorMessage(e,t)))},this))},getValidationTerms:function(e){var s=r(e).data("validate");return void 0!==s?s.trim().split(" "):!1},getTerm:function(r){return"!"===r.charAt(0)?r.substring(1):r},getModifier:function(r){var e=this.config.modifiers[r.charAt(0)];return void 0!==e?e:!1},getCompare:function(e,s){var t=r(e).data("compare-"+s.toLowerCase());return void 0===t?null:this.isNumber(t)?parseInt(t):t},getErrorMessage:function(e,s){var t=r(e).data("message-"+s.toLowerCase());return void 0!==t?t:""},resetErrors:function(){this.form.find(".field").removeClass(this.classes.error),this.form.find(".error-message, .error-message-explanation").remove()},newError:function(e,s){var t=r(e).attr("id"),i=this.form.find('label[for="'+t+'"]'),n=i.parents(".field").eq(0),o='<a href="#'+t+'">'+s+"</a>";n.addClass(this.classes.error),0===i.find(".error-message").length&&i.prepend('<span class="error-message">'+this.form.data("errors-prefix")+"</span>"),i.append('<span class="error-message-explanation"><span>'+s+"</span></span>"),this.errors.push(o)},newFieldsetError:function(e,s){var t=r(e),i=t.attr("id"),n=t.find("legend"),o='<a href="#'+i+'">'+s+"</a>";t.addClass(this.classes.error),0===n.find(".error-message").length&&n.prepend('<span class="error-message">'+this.form.data("errors-prefix")+"</span>"),n.append('<span class="error-message-explanation"><span>'+s+"</span></span>"),this.errors.push(o)},displayErrors:function(){this.form.find(".errors").remove(),this.errors.length>0&&(this.form.prepend('<div class="errors"></div>'),this.form.errors=this.form.find("> .errors"),this.form.errors.append("<p>"+this.form.data("errors-message").replace("{n}",this.errors.length).replace("{s}",this.errors.length>1?"s":"")+"</p>"),this.form.errors.append("<ul></ul>"),this.form.errorsList=this.form.find("> .errors > ul"),_.each(this.errors,r.proxy(function(r){this.form.errorsList.append("<li>"+r+"</li>")},this)),this.bindErrorsEvents())},isNumber:function(r){return r?r.toString().match(/^[0-9]+$/)&&!isNaN(parseInt(r)):!1}}),r.fn.form=function(s){return this.each(function(){var t=r(this);if(!t.data("form")){var i=new e(this,s);t.data("form",i)}})}}(jQuery);