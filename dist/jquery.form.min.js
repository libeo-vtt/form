!function(r){var e=function(e,s){this.form=r(e),this.config=r.extend({focusTopSubmit:!0,modifiers:{"!":"not"},customGlobalClasses:{}},s||{}),this.classes=r.extend({active:"is-active",open:"is-open",hover:"is-hover",clicked:"is-clicked",extern:"is-external",error:"is-error"},this.config.customGlobalClasses||{}),this.errors=[],this.publicMethods={newError:r.proxy(function(r,e){this.newError(r,e),this.displayErrors()},this),resetErrors:r.proxy(function(){this.resetErrors()},this)},this.init()};r.extend(e.prototype,{init:function(){this.bindEvents()},bindEvents:function(){this.form.on("submit",r.proxy(function(r){this.resetErrors(),this.validate(),this.displayErrors(),this.errors.length>0?(r.preventDefault(),this.form.trigger("submitErrors")):this.form.trigger("submitSuccess")},this))},bindErrorsEvents:function(){this.form.find(".errors a").on("click",r.proxy(function(e){var s=this.form.find(e.currentTarget.hash).parents(".field").find("label"),t=this.form.find(e.currentTarget.hash);t.focus(),r(window).scrollTop(s.offset().top),e.preventDefault()},this))},validate:function(){var e=this.form.find("input, textarea, select, fieldset");this.errors=[],e.each(r.proxy(function(r,e){"fieldset"===e.tagName.toLowerCase()?this.validateFieldset(e):this.validateInput(e)},this))},validateInput:function(e){var s,t,i=r(e).val(),o=this.isNumber(i)?parseInt(i):i,n=this.getValidationTerms(e),a=!1;n&&_.each(n,r.proxy(function(i){var n=!0,h=this.getTerm(i),f=this.getModifier(i),d=this.getCompare(e,h);if(!this.isNumber(o)&&this.isNumber(d)&&(o=o.length),"field"===h)s=r(d),t=r(e),t.val()!=s.val()&&(n=!1);else if("regex"===h){var l=new RegExp(d);n=l.test(o)}else n=f!==!1?is[f][h](o,d)?n:!1:is[h](o,d)?n:!1;n||"empty"!==h||(a=!0,this.newError(e,this.getErrorMessage(e,h))),n||a||this.newError(e,this.getErrorMessage(e,h))},this))},validateFieldset:function(e){var s=r(e),t=s.find("input"),i=this.getValidationTerms(e),o=[],n=!1,a=!1;t.each(function(e,t){r(t).is(":checked")?o.push(t):s.data("ranges")===!0&&(a=!0,"0"!==r(t).val()&&o.push(t))}),i&&_.each(i,r.proxy(function(r){var s=!0,i=this.getTerm(r),h=this.getModifier(r),f=this.getCompare(e,i);"empty"===i?(h!==!1?(s=is[h][i](o,f)?s:!1,a===!0&&o.length!==t.length&&(s=!1)):s=is[i](o,f)?s:!1,s||(n=!0,this.newFieldsetError(e,this.getErrorMessage(e,i)))):(s=h!==!1?is[h][i](o.length,f)?s:!1:is[i](o.length,f)?s:!1,s||n||this.newFieldsetError(e,this.getErrorMessage(e,i)))},this))},getValidationTerms:function(e){var s=r(e).attr("data-validate");return void 0!==s?s.trim().split(" "):!1},getTerm:function(r){return"!"===r.charAt(0)?r.substring(1):r},getModifier:function(r){var e=this.config.modifiers[r.charAt(0)];return void 0!==e?e:!1},getCompare:function(e,s){var t=r(e).data("compare-"+s.toLowerCase());return void 0===t?null:this.isNumber(t)?parseInt(t):t},getErrorMessage:function(e,s){var t=r(e).data("message-"+s.toLowerCase());return void 0!==t?t:""},resetErrors:function(){r(".errors").html(""),this.form.find(".field").removeClass(this.classes.error),this.form.find(".error-message, .error-message-explanation").remove()},newError:function(e,s){var t=r(e).attr("id"),i=this.form.find('label[for="'+t+'"]'),o=i.parents(".field").eq(0),n='<a href="#'+t+'">'+s+"</a>";o.addClass(this.classes.error),0===i.find(".error-message").length&&i.prepend('<span class="error-message">'+this.form.data("errors-prefix")+"</span>"),i.append('<span class="error-message-explanation"><span>'+s+"</span></span>"),this.errors.push(n)},newFieldsetError:function(e,s){var t=r(e),i=t.attr("id"),o=t.find("legend"),n='<a href="#'+i+'">'+s+"</a>";t.addClass(this.classes.error),0===o.find(".error-message").length&&o.prepend('<span class="error-message">'+this.form.data("errors-prefix")+"</span>"),o.append('<span class="error-message-explanation"><span>'+s+"</span></span>"),this.errors.push(n)},displayErrors:function(){if(this.form.find(".errors").remove(),this.errors.length>0){if(this.form.prepend('<div class="errors"></div>'),this.form.errors=this.form.find("> .errors"),this.form.errors.append("<p>"+this.form.data("errors-message").replace("{n}",this.errors.length).replace("{s}",this.errors.length>1?"s":"")+"</p>"),this.form.errors.append("<ul></ul>"),this.form.errorsList=this.form.find("> .errors > ul"),_.each(this.errors,r.proxy(function(r){this.form.errorsList.append("<li>"+r+"</li>")},this)),this.config.focusTopSubmit===!0){var e=this.form.find(".errors");e.attr("tabindex",-1),setTimeout(r.proxy(function(){e.focus()},this),0)}this.bindErrorsEvents()}},isNumber:function(r){return r?r.toString().match(/^[0-9]+$/)&&!isNaN(parseInt(r)):!1}}),r.fn.form=function(s){return this.each(r.proxy(function(t,i){var o=r(i);if(!o.data("form")){var n=new e(i,s);for(var a in n.publicMethods)this[a]=n.publicMethods[a];o.data("form",n)}},this)),this}}(jQuery);